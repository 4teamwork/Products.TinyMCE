(function(a){var e=a.each;function c(g,h){var j=h.ownerDocument,f=j.createRange(),k;f.setStartBefore(h);f.setEnd(g.endContainer,g.endOffset);k=j.createElement("body");k.appendChild(f.cloneContents());return k.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length==0}function d(g,f){return parseInt(g.getAttribute(f)||1)}function b(G,E,v){var f,L,F,n;h();n=E.getParent(v.getStart(),"th,td");if(n){L=D(n);F=A();n=K(L.x,L.y)}function J(N,M){N=N.cloneNode(M);N.removeAttribute("id");return N}function h(){var M=0;f=[];e(["thead","tbody","tfoot"],function(N){var O=E.select("> "+N+" tr",G);e(O,function(P,Q){Q+=M;e(E.select("> td, > th",P),function(W,R){var S,T,U,V;if(f[Q]){while(f[Q][R]){R++}}U=d(W,"rowspan");V=d(W,"colspan");for(T=Q;T<Q+U;T++){if(!f[T]){f[T]=[]}for(S=R;S<R+V;S++){f[T][S]={part:N,real:T==Q&&S==R,elm:W,rowspan:U,colspan:V}}}})});M+=O.length})}function K(M,O){var N;N=f[O];if(N){return N[M]}}function q(O,M,N){if(O){N=parseInt(N);if(N===1){O.removeAttribute(M,1)}else{O.setAttribute(M,N,1)}}}function g(M){return M&&(E.hasClass(M.elm,"mceSelected")||M==n)}function r(){var M=[];e(G.rows,function(N){e(N.cells,function(O){if(E.hasClass(O,"mceSelected")||O==n.elm){M.push(N);return false}})});return M}function j(){var M=E.createRng();M.setStartAfter(G);M.setEndAfter(G);v.setRng(M);E.remove(G)}function u(M){var N;a.walk(M,function(P){var O;if(P.nodeType==3){e(E.getParents(P.parentNode,null,M).reverse(),function(Q){Q=J(Q,false);if(!N){N=O=Q}else{if(O){O.appendChild(Q)}}O=Q});if(O){O.innerHTML=a.isIE?"&nbsp;":'<br data-mce-bogus="1" />'}return false}},"childNodes");M=J(M,false);q(M,"rowSpan",1);q(M,"colSpan",1);if(N){M.appendChild(N)}else{if(!a.isIE){M.innerHTML='<br data-mce-bogus="1" />'}}return M}function o(){var M=E.createRng();e(E.select("tr",G),function(N){if(N.cells.length==0){E.remove(N)}});if(E.select("tr",G).length==0){M.setStartAfter(G);M.setEndAfter(G);v.setRng(M);E.remove(G);return}e(E.select("thead,tbody,tfoot",G),function(N){if(N.rows.length==0){E.remove(N)}});h();row=f[Math.min(f.length-1,L.y)];if(row){v.select(row[Math.min(row.length-1,L.x)].elm,true);v.collapse(true)}}function t(S,R,U,Q){var O,N,M,P,T;O=f[R][S].elm.parentNode;for(M=1;M<=U;M++){O=E.getNext(O,"tr");if(O){for(N=S;N>=0;N--){T=f[R+M][N].elm;if(T.parentNode==O){for(P=1;P<=Q;P++){E.insertAfter(u(T),T)}break}}if(N==-1){for(P=1;P<=Q;P++){O.insertBefore(u(O.cells[0]),O.cells[0])}}}}}function z(){e(f,function(M,N){e(M,function(P,O){var S,R,T,Q;if(g(P)){P=P.elm;S=d(P,"colspan");R=d(P,"rowspan");if(S>1||R>1){q(P,"rowSpan",1);q(P,"colSpan",1);for(Q=0;Q<S-1;Q++){E.insertAfter(u(P),P)}t(O,N,R-1,S)}}})})}function m(U,S,Y){var N,O,X,V,T,R,W,Q,U,M,P;if(U){pos=D(U);N=pos.x;O=pos.y;X=N+(S-1);V=O+(Y-1)}else{N=L.x;O=L.y;X=F.x;V=F.y}W=K(N,O);Q=K(X,V);if(W&&Q&&W.part==Q.part){z();h();W=K(N,O).elm;q(W,"colSpan",(X-N)+1);q(W,"rowSpan",(V-O)+1);for(R=O;R<=V;R++){for(T=N;T<=X;T++){if(!f[R]||!f[R][T]){continue}U=f[R][T].elm;if(U!=W){M=a.grep(U.childNodes);e(M,function(Z){W.appendChild(Z)});if(M.length){M=a.grep(W.childNodes);P=0;e(M,function(Z){if(Z.nodeName=="BR"&&E.getAttrib(Z,"data-mce-bogus")&&P++<M.length-1){W.removeChild(Z)}})}E.remove(U)}}}o()}}function p(V){var N,U,M,R,S,T,O,Q,P;e(f,function(W,X){e(W,function(Z,Y){if(g(Z)){Z=Z.elm;S=Z.parentNode;T=J(S,false);N=X;if(V){return false}}});if(V){return !N}});for(R=0;R<f[0].length;R++){if(!f[N][R]){continue}U=f[N][R].elm;if(U!=M){if(!V){P=d(U,"rowspan");if(P>1){q(U,"rowSpan",P+1);continue}}else{if(N>0&&f[N-1][R]){Q=f[N-1][R].elm;P=d(Q,"rowSpan");if(P>1){q(Q,"rowSpan",P+1);continue}}}O=u(U);q(O,"colSpan",U.colSpan);T.appendChild(O);M=U}}if(T.hasChildNodes()){if(!V){E.insertAfter(T,S)}else{S.parentNode.insertBefore(T,S)}}}function s(M){var O,N;e(f,function(P,Q){e(P,function(S,R){if(g(S)){O=R;if(M){return false}}});if(M){return !O}});e(f,function(S,T){var P,Q,R;if(!S[O]){return}P=S[O].elm;if(P!=N){R=d(P,"colspan");Q=d(P,"rowspan");if(R==1){if(!M){E.insertAfter(u(P),P);t(O,T,Q-1,R)}else{P.parentNode.insertBefore(u(P),P);t(O,T,Q-1,R)}}else{q(P,"colSpan",P.colSpan+1)}N=P}})}function l(){var M=[];e(f,function(N,O){e(N,function(Q,P){if(g(Q)&&a.inArray(M,P)===-1){e(f,function(T){var R=T[P].elm,S;S=d(R,"colSpan");if(S>1){q(R,"colSpan",S-1)}else{E.remove(R)}});M.push(P)}})});o()}function k(){var N;function M(Q){var O,R,P;O=E.getNext(Q,"tr");e(Q.cells,function(S){var T=d(S,"rowSpan");if(T>1){q(S,"rowSpan",T-1);R=D(S);t(R.x,R.y,1,1)}});R=D(Q.cells[0]);e(f[R.y],function(S){var T;S=S.elm;if(S!=P){T=d(S,"rowSpan");if(T<=1){E.remove(S)}else{q(S,"rowSpan",T-1)}P=S}})}N=r();e(N.reverse(),function(O){M(O)});o()}function C(){var M=r();E.remove(M);o();return M}function B(){var M=r();e(M,function(O,N){M[N]=J(O,true)});return M}function H(O,M){var Q=r(),N=Q[M?0:Q.length-1],P=N.cells.length;e(f,function(S){var R;P=0;e(S,function(U,T){if(U.real){P+=U.colspan}if(U.elm.parentNode==N){R=1}});if(R){return false}});if(!M){O.reverse()}e(O,function(T){var S=T.cells.length,R;for(i=0;i<S;i++){R=T.cells[i];q(R,"colSpan",1);q(R,"rowSpan",1)}for(i=S;i<P;i++){T.appendChild(u(T.cells[S-1]))}for(i=P;i<S;i++){E.remove(T.cells[i])}if(M){N.parentNode.insertBefore(T,N)}else{E.insertAfter(T,N)}})}function D(N){var M;e(f,function(O,P){e(O,function(R,Q){if(R.elm==N){M={x:Q,y:P};return false}});return !M});return M}function I(M){L=D(M)}function A(){var O,N,M;N=M=0;e(f,function(P,Q){e(P,function(S,R){var U,T;if(g(S)){S=f[Q][R];if(R>N){N=R}if(Q>M){M=Q}if(S.real){U=S.colspan-1;T=S.rowspan-1;if(U){if(R+U>N){N=R+U}}if(T){if(Q+T>M){M=Q+T}}}}})});return{x:N,y:M}}function w(S){var O,P,U,T,N,M,Q,R;F=D(S);if(L&&F){O=Math.min(L.x,F.x);P=Math.min(L.y,F.y);U=Math.max(L.x,F.x);T=Math.max(L.y,F.y);N=U;M=T;for(y=P;y<=M;y++){S=f[y][O];if(!S.real){if(O-(S.colspan-1)<O){O-=S.colspan-1}}}for(x=O;x<=N;x++){S=f[P][x];if(!S.real){if(P-(S.rowspan-1)<P){P-=S.rowspan-1}}}for(y=P;y<=T;y++){for(x=O;x<=U;x++){S=f[y][x];if(S.real){Q=S.colspan-1;R=S.rowspan-1;if(Q){if(x+Q>N){N=x+Q}}if(R){if(y+R>M){M=y+R}}}}}E.removeClass(E.select("td.mceSelected,th.mceSelected"),"mceSelected");for(y=P;y<=M;y++){for(x=O;x<=N;x++){if(f[y][x]){E.addClass(f[y][x].elm,"mceSelected")}}}}}a.extend(this,{deleteTable:j,split:z,merge:m,insertRow:p,insertCol:s,deleteCols:l,deleteRows:k,cutRows:C,copyRows:B,pasteRows:H,getPos:D,setStartCell:I,setEndCell:w})}a.create("tinymce.plugins.TablePlugin",{init:function(f,h){var k,m,g=true;function l(p){var n=f.selection,o=f.dom.getParent(p||n.getNode(),"table");if(o){return new b(o,f.dom,n)}}function j(){f.getBody().style.webkitUserSelect="";if(g){f.dom.removeClass(f.dom.select("td.mceSelected,th.mceSelected"),"mceSelected");g=false}}e([["table","table.desc","mceInsertTable",true],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",true],["cell_props","table.cell_desc","mceTableCellProps",true],["split_cells","table.split_cells_desc","mceTableSplitCells",true],["merge_cells","table.merge_cells_desc","mceTableMergeCells",true]],function(n){f.addButton(n[0],{title:n[1],cmd:n[2],ui:n[3]})});if(!a.isIE){f.onClick.add(function(n,o){o=o.target;if(o.nodeName==="TABLE"){n.selection.select(o);n.nodeChanged()}})}f.onPreProcess.add(function(o,p){var n,q,r,t=o.dom,s;n=t.select("table",p.node);q=n.length;while(q--){r=n[q];t.setAttrib(r,"data-mce-style","");if((s=t.getAttrib(r,"width"))){t.setStyle(r,"width",s);t.setAttrib(r,"width","")}if((s=t.getAttrib(r,"height"))){t.setStyle(r,"height",s);t.setAttrib(r,"height","")}}});f.onNodeChange.add(function(q,o,s){var r;s=q.selection.getStart();r=q.dom.getParent(s,"td,th,caption");o.setActive("table",s.nodeName==="TABLE"||!!r);if(r&&r.nodeName==="CAPTION"){r=0}o.setDisabled("delete_table",!r);o.setDisabled("delete_col",!r);o.setDisabled("delete_table",!r);o.setDisabled("delete_row",!r);o.setDisabled("col_after",!r);o.setDisabled("col_before",!r);o.setDisabled("row_after",!r);o.setDisabled("row_before",!r);o.setDisabled("row_props",!r);o.setDisabled("cell_props",!r);o.setDisabled("split_cells",!r);o.setDisabled("merge_cells",!r)});f.onInit.add(function(r){var q,v,p=r.dom,u;k=r.windowManager;r.onMouseDown.add(function(w,z){if(z.button!=2){j();v=p.getParent(z.target,"td,th");q=p.getParent(v,"table")}});p.bind(r.getDoc(),"mouseover",function(B){var A,z,C=B.target;if(v&&(u||C!=v)&&(C.nodeName=="TD"||C.nodeName=="TH")){z=p.getParent(C,"table");if(z==q){if(!u){u=l(z);u.setStartCell(v);r.getBody().style.webkitUserSelect="none"}u.setEndCell(C);g=true}A=r.selection.getSel();try{if(A.removeAllRanges){A.removeAllRanges()}else{A.empty()}}catch(w){}B.preventDefault()}});r.onMouseUp.add(function(D,E){var w,z=D.selection,G,I=z.getSel(),H,B,F,A;if(v){if(u){D.getBody().style.webkitUserSelect=""}function C(J,L){var K=new a.dom.TreeWalker(J,J);do{if(J.nodeType==3&&a.trim(J.nodeValue).length!=0){if(L){w.setStart(J,0)}else{w.setEnd(J,J.nodeValue.length)}return}if(J.nodeName=="BR"){if(L){w.setStartBefore(J)}else{w.setEndBefore(J)}return}}while(J=(L?K.next():K.prev()))}G=p.select("td.mceSelected,th.mceSelected");if(G.length>0){w=p.createRng();B=G[0];A=G[G.length-1];w.setStartBefore(B);w.setEndAfter(B);C(B,1);H=new a.dom.TreeWalker(B,p.getParent(G[0],"table"));do{if(B.nodeName=="TD"||B.nodeName=="TH"){if(!p.hasClass(B,"mceSelected")){break}F=B}}while(B=H.next());C(F);z.setRng(w)}D.nodeChanged();v=u=q=null}});r.onKeyUp.add(function(w,z){j()});r.onKeyDown.add(function(w,z){n(w)});r.onMouseDown.add(function(w,z){if(z.button!=2){n(w)}});function o(D,w,A,F){var B=3,G=D.dom.getParent(w.startContainer,"TABLE"),C,z,E;if(G){C=G.parentNode}z=w.startContainer.nodeType==B&&w.startOffset==0&&w.endOffset==0&&F&&(A.nodeName=="TR"||A==C);E=(A.nodeName=="TD"||A.nodeName=="TH")&&!F;return z||E}function n(A){if(!a.isWebKit){return}var z=A.selection.getRng();var C=A.selection.getNode();var B=A.dom.getParent(z.startContainer,"TD,TH");if(!o(A,z,C,B)){return}if(!B){B=C}var w=B.lastChild;while(w.lastChild){w=w.lastChild}z.setEnd(w,w.nodeValue.length);A.selection.setRng(z)}r.plugins.table.fixTableCellSelection=n;if(r&&r.plugins.contextmenu){r.plugins.contextmenu.onContextMenu.add(function(A,w,C){var D,B=r.selection,z=B.getNode()||r.getBody();if(r.dom.getParent(C,"td")||r.dom.getParent(C,"th")||r.dom.select("td.mceSelected,th.mceSelected").length){w.removeAll();if(z.nodeName=="A"&&!r.dom.getAttrib(z,"name")){w.add({title:"advanced.link_desc",icon:"link",cmd:r.plugins.advlink?"mceAdvLink":"mceLink",ui:true});w.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});w.addSeparator()}if(z.nodeName=="IMG"&&z.className.indexOf("mceItem")==-1){w.add({title:"advanced.image_desc",icon:"image",cmd:r.plugins.advimage?"mceAdvImage":"mceImage",ui:true});w.addSeparator()}w.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}});w.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"});w.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"});w.addSeparator();D=w.addMenu({title:"table.cell"});D.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"});D.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"});D.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"});D=w.addMenu({title:"table.row"});D.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"});D.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"});D.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"});D.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"});D.addSeparator();D.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"});D.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"});D.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!m);D.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!m);D=w.addMenu({title:"table.col"});D.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"});D.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"});D.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})}else{w.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})}})}if(a.isWebKit){function t(D,N){var L=a.VK;var Q=N.keyCode;function K(aa,U,R){var W=aa?"previousSibling":"nextSibling";var Z=D.dom.getParent(U,"tr");var V=Z[W];if(V){z(D,U,V,aa);a.dom.Event.cancel(R);return true}else{var Y=D.dom.getParent(Z,"table");var T=Z.parentNode;var X=T.nodeName.toLowerCase();if(X==="tbody"||X===(aa?"tfoot":"thead")){var S=w(aa,Y,T,"tbody");if(S!==null){return O(aa,S,U,R)}}return M(aa,Z,W,Y,R)}}function w(S,T,U,X){var V=D.dom.select(">"+X,T);var R=V.indexOf(U);if(S&&R===0||!S&&R===V.length-1){return B(S,T)}else{if(R===-1){var W=U.tagName.toLowerCase()==="thead"?0:V.length-1;return V[W]}else{return V[R+(S?-1:1)]}}}function B(S,T){var U=S?"thead":"tfoot";var R=D.dom.select(">"+U,T);return R.length!==0?R[0]:null}function O(R,U,T,V){var S=I(U,R);S&&z(D,T,S,R);a.dom.Event.cancel(V);return true}function M(R,U,Y,X,W){var V=X[Y];if(V){A(V);return true}else{var S=D.dom.getParent(X,"td,th");if(S){return K(R,S,W)}else{var T=I(U,!R);A(T);return a.dom.Event.cancel(W)}}}function I(S,R){return S&&S[R?"lastChild":"firstChild"]}function A(R){D.selection.setCursorLocation(R,0)}function F(){return Q==L.UP||Q==L.DOWN}function E(R){var T=R.selection.getNode();var S=R.dom.getParent(T,"tr");return S!==null}function J(R){var S=0;var T=R;while(T.previousSibling){T=T.previousSibling;S=S+d(T,"colspan")}return S}function C(T,R){var U=0;var S=0;e(T.children,function(V,W){U=U+d(V,"colspan");S=W;if(U>R){return false}});return S}function z(U,X,Y,T){var R=J(U.dom.getParent(X,"td,th"));var W=C(Y,R);var V=Y.childNodes[W];var S=I(V,T);A(S||V)}function P(S){var U=D.selection.getNode();var R=D.dom.getParent(U,"td,th");var T=D.dom.getParent(S,"td,th");return R&&R!==T&&H(R,T)}function H(R,S){return D.dom.getParent(R,"TABLE")===D.dom.getParent(S,"TABLE")}if(F()&&E(D)){var G=D.selection.getNode();setTimeout(function(){if(P(G)){K(!N.shiftKey&&Q===L.UP,G,N)}},0)}}r.onKeyDown.add(t)}if(!a.isIE){function s(){var w;for(w=r.getBody().lastChild;w&&w.nodeType==3&&!w.nodeValue.length;w=w.previousSibling){}if(w&&w.nodeName=="TABLE"){r.dom.add(r.getBody(),"p",null,'<br mce_bogus="1" />')}}if(a.isGecko){r.onKeyDown.add(function(z,B){var w,A,C=z.dom;if(B.keyCode==37||B.keyCode==38){w=z.selection.getRng();A=C.getParent(w.startContainer,"table");if(A&&z.getBody().firstChild==A){if(c(w,A)){w=C.createRng();w.setStartBefore(A);w.setEndBefore(A);z.selection.setRng(w);B.preventDefault()}}}})}r.onKeyUp.add(s);r.onSetContent.add(s);r.onVisualAid.add(s);r.onPreProcess.add(function(w,A){var z=A.node.lastChild;if(z&&z.childNodes.length==1&&z.firstChild.nodeName=="BR"){w.dom.remove(z)}});s();r.startContent=r.getContent({format:"raw"})}});e({mceTableSplitCells:function(n){n.split()},mceTableMergeCells:function(o){var p,q,n;n=f.dom.getParent(f.selection.getNode(),"th,td");if(n){p=n.rowSpan;q=n.colSpan}if(!f.dom.select("td.mceSelected,th.mceSelected").length){k.open({url:h+"/merge_cells.htm",width:360+parseInt(f.getLang("table.merge_cells_delta_width",0)),height:150+parseInt(f.getLang("table.merge_cells_delta_height",0)),inline:1},{rows:p,cols:q,onaction:function(r){o.merge(n,r.cols,r.rows)},plugin_url:h})}else{o.merge()}},mceTableInsertRowBefore:function(n){n.insertRow(true)},mceTableInsertRowAfter:function(n){n.insertRow()},mceTableInsertColBefore:function(n){n.insertCol(true)},mceTableInsertColAfter:function(n){n.insertCol()},mceTableDeleteCol:function(n){n.deleteCols()},mceTableDeleteRow:function(n){n.deleteRows()},mceTableCutRow:function(n){m=n.cutRows()},mceTableCopyRow:function(n){m=n.copyRows()},mceTablePasteRowBefore:function(n){n.pasteRows(m,true)},mceTablePasteRowAfter:function(n){n.pasteRows(m)},mceTableDelete:function(n){n.deleteTable()}},function(o,n){f.addCommand(n,function(){var p=l();if(p){o(p);f.execCommand("mceRepaint");j()}})});e({mceInsertTable:function(n){k.open({url:h+"/table.htm",width:400+parseInt(f.getLang("table.table_delta_width",0)),height:270+parseInt(f.getLang("table.table_delta_height",0)),inline:1},{plugin_url:h,action:n?n.action:0})},mceTableRowProps:function(){k.open({url:h+"/row.htm",width:360+parseInt(f.getLang("table.rowprops_delta_width",0)),height:230+parseInt(f.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:h})},mceTableCellProps:function(){k.open({url:h+"/cell.htm",width:360+parseInt(f.getLang("table.cellprops_delta_width",0)),height:270+parseInt(f.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:h})}},function(o,n){f.addCommand(n,function(p,q){o(q)})})}});a.PluginManager.add("table",a.plugins.TablePlugin)})(tinymce);