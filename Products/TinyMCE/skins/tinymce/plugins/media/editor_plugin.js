(function(){var d=tinymce.explode("id,name,width,height,style,align,class,hspace,vspace,bgcolor,type"),h=tinymce.makeMap(d.join(",")),c=tinymce.html.Node,f,e,g=tinymce.util.JSON,a;f=[["Flash","d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["ShockWave","166b1bca-3f9c-11cf-8075-444553540000","application/x-director","http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"],["WindowsMedia","6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a","application/x-mplayer2","http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"],["QuickTime","02bf25d5-8c17-4b23-bc80-d3488abddc6b","video/quicktime","http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"],["RealMedia","cfcdaa03-8be4-11cf-b84b-0020afbbccfa","audio/x-pn-realaudio-plugin","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["Java","8ad9c840-044e-11d1-b3e9-00805f499d93","application/x-java-applet","http://java.sun.com/products/plugin/autodl/jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0"],["Silverlight","dfeaf541-f3e1-4c24-acac-99c30715084a","application/x-silverlight-2"],["Iframe"],["Video"],["EmbeddedAudio"],["Audio"]];function b(m){var l,j,k;if(m&&!m.splice){j=[];for(k=0;true;k++){if(m[k]){j[k]=m[k]}else{break}}return j}return m}tinymce.create("tinymce.plugins.MediaPlugin",{init:function(n,l){var q=this,o={},m,p,r,k;function j(i){return i&&i.nodeName==="IMG"&&n.dom.hasClass(i,"mceItemMedia")}q.editor=n;q.url=l;e="";for(m=0;m<f.length;m++){k=f[m][0];r={name:k,clsids:tinymce.explode(f[m][1]||""),mimes:tinymce.explode(f[m][2]||""),codebase:f[m][3]};for(p=0;p<r.clsids.length;p++){o["clsid:"+r.clsids[p]]=r}for(p=0;p<r.mimes.length;p++){o[r.mimes[p]]=r}o["mceItem"+k]=r;o[k.toLowerCase()]=r;e+=(e?"|":"")+k}tinymce.each(n.getParam("media_types","video=mp4,m4v,ogv,webm;silverlight=xap;flash=swf,flv;shockwave=dcr;quicktime=mov,qt,mpg,mpeg;shockwave=dcr;windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;realmedia=rm,ra,ram;java=jar;audio=mp3,ogg").split(";"),function(v){var t,s,u;v=v.split(/=/);s=tinymce.explode(v[1].toLowerCase());for(t=0;t<s.length;t++){u=o[v[0].toLowerCase()];if(u){o[s[t]]=u}}});e=new RegExp("write("+e+")\\(([^)]+)\\)");q.lookup=o;n.onPreInit.add(function(){n.schema.addValidElements("object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]");n.parser.addNodeFilter("object,embed,video,audio,script,iframe",function(s){var t=s.length;while(t--){q.objectToImg(s[t])}});n.serializer.addNodeFilter("img",function(s,u,t){var v=s.length,w;while(v--){w=s[v];if((w.attr("class")||"").indexOf("mceItemMedia")!==-1){q.imgToObject(w,t)}}})});n.onInit.add(function(){if(n.theme&&n.theme.onResolveName){n.theme.onResolveName.add(function(i,s){if(s.name==="img"&&n.dom.hasClass(s.node,"mceItemMedia")){s.name="media"}})}if(n&&n.plugins.contextmenu){n.plugins.contextmenu.onContextMenu.add(function(i,t,s){if(s.nodeName==="IMG"&&s.className.indexOf("mceItemMedia")!==-1){t.add({title:"media.edit",icon:"media",cmd:"mceMedia"})}})}});n.addCommand("mceMedia",function(){var s,i;i=n.selection.getNode();if(j(i)){s=n.dom.getAttrib(i,"data-mce-json");if(s){s=g.parse(s);tinymce.each(d,function(t){var u=n.dom.getAttrib(i,t);if(u){s[t]=u}});s.type=q.getType(i.className).name.toLowerCase()}}if(!s){s={type:"flash",video:{sources:[]},params:{}}}n.windowManager.open({file:l+"/media.htm",width:600+parseInt(n.getLang("media.delta_width",0)),height:470+parseInt(n.getLang("media.delta_height",0)),inline:1},{plugin_url:l,data:s})});n.addButton("media",{title:"media.desc",cmd:"mceMedia"});n.onNodeChange.add(function(s,i,t){i.setActive("media",j(t))})},convertUrl:function(k,n){var j=this,i=j.editor,l=i.settings,o=l.url_converter,m=l.url_converter_scope||j;if(!k){return k}if(n){return i.documentBaseURI.toAbsolute(k)}return o.call(m,k,"src","object")},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion}},dataToImg:function(n,k){var q=this,j=q.editor,r=j.documentBaseURI,o,p,m,l;n.params.src=q.convertUrl(n.params.src,k);p=n.video.attrs;if(p){p.src=q.convertUrl(p.src,k)}if(p){p.poster=q.convertUrl(p.poster,k)}o=b(n.video.sources);if(o){for(l=0;l<o.length;l++){o[l].src=q.convertUrl(o[l].src,k)}}m=q.editor.dom.create("img",{id:n.id,style:n.style,align:n.align,hspace:n.hspace,vspace:n.vspace,src:q.editor.theme.url+"/img/trans.gif","class":"mceItemMedia mceItem"+q.getType(n.type).name,"data-mce-json":g.serialize(n,"'")});m.width=n.width||(n.type=="audio"?"300":"320");m.height=n.height||(n.type=="audio"?"32":"240");return m},dataToHtml:function(i,j){return this.editor.serializer.serialize(this.dataToImg(i,j),{forced_root_block:"",force_absolute:j})},htmlToData:function(k){var j,i,l;l={type:"flash",video:{sources:[]},params:{}};j=this.editor.parser.parse(k);i=j.getAll("img")[0];if(i){l=g.parse(i.attr("data-mce-json"));l.type=this.getType(i.attr("class")).name.toLowerCase();tinymce.each(d,function(m){var n=i.attr(m);if(n){l[m]=n}})}return l},getType:function(m){var k,l,j;l=tinymce.explode(m," ");for(k=0;k<l.length;k++){j=this.lookup[l[k]];if(j){return j}}},imgToObject:function(z,l){var v=this,r=v.editor,D,u,j,m,I,A,H,F,t,x,q,p,B,E,s,y,k,C,G;function o(i,n){var M,L,N,K,J;J=r.getParam("flash_video_player_url",v.convertUrl(v.url+"/moxieplayer.swf"));if(J){M=r.documentBaseURI;H.params.src=J;if(r.getParam("flash_video_player_absvideourl",true)){i=M.toAbsolute(i||"",true);n=M.toAbsolute(n||"",true)}N="";L=r.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"});tinymce.each(L,function(P,O){P=P.replace(/\$url/,i||"");P=P.replace(/\$poster/,n||"");if(P.length>0){N+=(N?"&":"")+O+"="+escape(P)}});if(N.length){H.params.flashvars=N}K=r.getParam("flash_video_player_params",{allowfullscreen:true,allowscriptaccess:true});tinymce.each(K,function(P,O){H.params[O]=""+P})}}H=z.attr("data-mce-json");if(!H){return}H=g.parse(H);p=this.getType(z.attr("class"));C=z.attr("data-mce-style");if(!C){C=z.attr("style");if(C){C=r.dom.serializeStyle(r.dom.parseStyle(C,"img"))}}if(p.name==="Iframe"){y=new c("iframe",1);tinymce.each(d,function(i){var n=z.attr(i);if(i=="class"&&n){n=n.replace(/mceItem.+ ?/g,"")}if(n&&n.length>0){y.attr(i,n)}});for(I in H.params){y.attr(I,H.params[I])}y.attr({style:C,src:H.params.src});z.replace(y);return}if(this.editor.settings.media_use_script){y=new c("script",1).attr("type","text/javascript");A=new c("#text",3);A.value="write"+p.name+"("+g.serialize(tinymce.extend(H.params,{width:z.attr("width"),height:z.attr("height")}))+");";y.append(A);z.replace(y);return}if(p.name==="Video"&&H.video.sources[0]){D=new c("video",1).attr(tinymce.extend({id:z.attr("id"),width:z.attr("width"),height:z.attr("height"),style:C},H.video.attrs));if(H.video.attrs){k=H.video.attrs.poster}t=H.video.sources=b(H.video.sources);for(B=0;B<t.length;B++){if(/\.mp4$/.test(t[B].src)){s=t[B].src}}if(!t[0].type){D.attr("src",t[0].src);t.splice(0,1)}for(B=0;B<t.length;B++){F=new c("source",1).attr(t[B]);F.shortEnded=true;D.append(F)}if(s){o(s,k);p=v.getType("flash")}else{H.params.src=""}}if(p.name==="Audio"&&H.video.sources[0]){G=new c("audio",1).attr(tinymce.extend({id:z.attr("id"),width:z.attr("width"),height:z.attr("height"),style:C},H.video.attrs));if(H.video.attrs){k=H.video.attrs.poster}t=H.video.sources=b(H.video.sources);if(!t[0].type){G.attr("src",t[0].src);t.splice(0,1)}for(B=0;B<t.length;B++){F=new c("source",1).attr(t[B]);F.shortEnded=true;G.append(F)}H.params.src=""}if(p.name==="EmbeddedAudio"){j=new c("embed",1);j.shortEnded=true;j.attr({id:z.attr("id"),width:z.attr("width"),height:z.attr("height"),style:C,type:z.attr("type")});for(I in H.params){j.attr(I,H.params[I])}tinymce.each(d,function(i){if(H[i]&&i!="type"){j.attr(i,H[i])}});H.params.src=""}if(H.params.src){if(/\.flv$/i.test(H.params.src)){o(H.params.src,"")}if(l&&l.force_absolute){H.params.src=r.documentBaseURI.toAbsolute(H.params.src)}u=new c("object",1).attr({id:z.attr("id"),width:z.attr("width"),height:z.attr("height"),style:C});tinymce.each(d,function(i){var n=H[i];if(i=="class"&&n){n=n.replace(/mceItem.+ ?/g,"")}if(n&&i!="type"){u.attr(i,n)}});for(I in H.params){q=new c("param",1);q.shortEnded=true;A=H.params[I];if(I==="src"&&p.name==="WindowsMedia"){I="url"}q.attr({name:I,value:A});u.append(q)}if(this.editor.getParam("media_strict",true)){u.attr({data:H.params.src,type:p.mimes[0]})}else{u.attr({classid:"clsid:"+p.clsids[0],codebase:p.codebase});j=new c("embed",1);j.shortEnded=true;j.attr({id:z.attr("id"),width:z.attr("width"),height:z.attr("height"),style:C,type:p.mimes[0]});for(I in H.params){j.attr(I,H.params[I])}tinymce.each(d,function(i){if(H[i]&&i!="type"){j.attr(i,H[i])}});u.append(j)}if(H.object_html){A=new c("#text",3);A.raw=true;A.value=H.object_html;u.append(A)}if(D){D.append(u)}}if(D){if(H.video_html){A=new c("#text",3);A.raw=true;A.value=H.video_html;D.append(A)}}if(G){if(H.video_html){A=new c("#text",3);A.raw=true;A.value=H.video_html;G.append(A)}}var w=D||G||u||j;if(w){z.replace(w)}else{z.remove()}},objectToImg:function(C){var v,j,G,l,N,M,x,A,I,F,E,r,p,B,H,s,K,n,z=this.lookup,k,y,u=this.editor.settings.url_converter,q=this.editor.settings.url_converter_scope,J,m,D,t;function L(i){return new tinymce.html.Serializer({inner:true,validate:false}).serialize(i)}function w(O,i){return z[(O.attr(i)||"").toLowerCase()]}function o(O){var i=O.replace(/^.*\.([^.]+)$/,"$1");return z[i.toLowerCase()||""]}if(!C.parent){return}if(C.name==="script"){if(C.firstChild){k=e.exec(C.firstChild.value)}if(!k){return}n=k[1];K={video:{},params:g.parse(k[2])};A=K.params.width;I=K.params.height}K=K||{video:{},params:{}};N=new c("img",1);N.attr({src:this.editor.theme.url+"/img/trans.gif"});M=C.name;if(M==="video"||M=="audio"){G=C;v=C.getAll("object")[0];j=C.getAll("embed")[0];A=G.attr("width");I=G.attr("height");x=G.attr("id");K.video={attrs:{},sources:[]};y=K.video.attrs;for(M in G.attributes.map){y[M]=G.attributes.map[M]}H=C.attr("src");if(H){K.video.sources.push({src:u.call(q,H,"src",C.name)})}s=G.getAll("source");for(E=0;E<s.length;E++){H=s[E].remove();K.video.sources.push({src:u.call(q,H.attr("src"),"src","source"),type:H.attr("type"),media:H.attr("media")})}if(y.poster){y.poster=u.call(q,y.poster,"poster",C.name)}}if(C.name==="object"){v=C;j=C.getAll("embed")[0]}if(C.name==="embed"){j=C}if(C.name==="iframe"){l=C;n="Iframe"}if(v){A=A||v.attr("width");I=I||v.attr("height");F=F||v.attr("style");x=x||v.attr("id");J=J||v.attr("hspace");m=m||v.attr("vspace");D=D||v.attr("align");t=t||v.attr("bgcolor");K.name=v.attr("name");B=v.getAll("param");for(E=0;E<B.length;E++){p=B[E];M=p.remove().attr("name");if(!h[M]){K.params[M]=p.attr("value")}}K.params.src=K.params.src||v.attr("data")}if(j){A=A||j.attr("width");I=I||j.attr("height");F=F||j.attr("style");x=x||j.attr("id");J=J||j.attr("hspace");m=m||j.attr("vspace");D=D||j.attr("align");t=t||j.attr("bgcolor");for(M in j.attributes.map){if(!h[M]&&!K.params[M]){K.params[M]=j.attributes.map[M]}}}if(l){A=l.attr("width");I=l.attr("height");F=F||l.attr("style");x=l.attr("id");J=l.attr("hspace");m=l.attr("vspace");D=l.attr("align");t=l.attr("bgcolor");tinymce.each(d,function(i){N.attr(i,l.attr(i))});for(M in l.attributes.map){if(!h[M]&&!K.params[M]){K.params[M]=l.attributes.map[M]}}}if(K.params.movie){K.params.src=K.params.src||K.params.movie;delete K.params.movie}if(K.params.src){K.params.src=u.call(q,K.params.src,"src","object")}if(G){if(C.name==="video"){n=z.video.name}else{if(C.name==="audio"){n=z.audio.name}}}if(v&&!n){n=(w(v,"clsid")||w(v,"classid")||w(v,"type")||{}).name}if(j&&!n){n=(w(j,"type")||o(K.params.src)||{}).name}if(j&&n=="EmbeddedAudio"){K.params.type=j.attr("type")}C.replace(N);if(j){j.remove()}if(v){r=L(v.remove());if(r){K.object_html=r}}if(G){r=L(G.remove());if(r){K.video_html=r}}K.hspace=J;K.vspace=m;K.align=D;K.bgcolor=t;N.attr({id:x,"class":"mceItemMedia mceItem"+(n||"Flash"),style:F,width:A||(C.name=="audio"?"300":"320"),height:I||(C.name=="audio"?"32":"240"),hspace:J,vspace:m,align:D,bgcolor:t,"data-mce-json":g.serialize(K,"'")})}});tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)})();